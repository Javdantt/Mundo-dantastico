<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mundo Dantastico</title>
    
    <!-- React y ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fuentes -->
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;0,700;1,400&family=Space+Grotesk:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        .font-serif { font-family: 'Cormorant Garamond', serif; }
        .font-display { font-family: 'Space Grotesk', sans-serif; }
        .font-mono { font-family: 'Space Grotesk', monospace; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.8s ease-out; }
        .animate-slide-up { animation: slideUp 0.8s ease-out; }
    </style>
</head>
<body class="bg-[#f4f1ea] text-[#2c2926]">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- ICONOS ---
        const Icon = ({ path, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {path}
            </svg>
        );
        const Feather = (p) => <Icon {...p} path={<><path d="M20.24 12.24a6 6 0 0 0-8.49-8.49L5 10.5V19h8.5z"></path><line x1="16" y1="8" x2="2" y2="22"></line><line x1="17.5" y1="15" x2="9" y2="15"></line></>} />;
        const Moon = (p) => <Icon {...p} path={<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>} />;
        const Sun = (p) => <Icon {...p} path={<><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></>} />;
        const PenTool = (p) => <Icon {...p} path={<><path d="M12 19l7-7 3 3-7 7-3-3z"></path><path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path><path d="M2 2l7.586 7.586"></path><circle cx="11" cy="11" r="2"></circle></>} />;
        const BookOpen = (p) => <Icon {...p} path={<><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></>} />;
        const ChevronLeft = (p) => <Icon {...p} path={<polyline points="15 18 9 12 15 6"></polyline>} />;
        const Trash2 = (p) => <Icon {...p} path={<><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></>} />;
        const Save = (p) => <Icon {...p} path={<><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></>} />;

        // ----------------------------------------------------------------------
        // BIBLIOTECA OFICIAL
        // ----------------------------------------------------------------------
        
        const BIBLIOTECA_OFICIAL = [
            {
                id: 1,
                title: "Humo de Obra",
                author: "Javier Dantas",
                date: "29 Nov 2025",
                // Imagen cargada correctamente desde Postimages
                image: "https://i.postimg.cc/K8wGL72B/Gemini-Generated-Image-8ndzi78ndzi78ndz.png", 
                content: "Los albañiles tienen en su contratación un derecho no escrito: el de percibir un asado para todos en los hitos importantes durante la obra. Es decir que los obreros trabajan durante la mañana y luego al mediodía compran la carne y todo para hacer un asado en la obra. Esto generalmente sucede los “viernes de asados”. Entre materiales y la obra en construcción, el fuego se hace presente. El humo recorre habitaciones y pisos del lugar.\n\nEn algunas religiones y creencias populares de Latinoamérica tienen la particularidad de utilizar el humo para espantar los malos espíritus. Sin embargo, un buen día en la obra de un edificio, los obreros habían terminado el llenado de losa y, estando allí el maestro de obra, recibe la pregunta por el asado, quien consulta con el dueño. Pero al desconocer o enfrentarse con esta disquisición, le pareció injusto y decidió no pagar nada. Aún así, los descontentos obreros se propusieron a hacer una colecta para hacer su asado de viernes, como era costumbre con otros patrones. De todos modos, el dueño insistió en que no hagan el asado, por cierto temor a reclamo de pagarlo, que el hecho de cocinar atrase la obra y un poco por envidia.\n\nAl enterarse un sindicalista, se presentó el viernes siguiente al mediodía en el lugar. El representante de la UOCRA observó la negación. Se acercó al dueño y le comunicó amigablemente que existe un convenio colectivo donde él estaba obligado a pagar por el tiempo de cocción de la carne. Además, le sugirió que pague al menos un asado al finalizar la obra, como un incentivo para los trabajadores. El hombre se desentendió de la ley y del “pago extra”, ya que argumentaba que ya estaba pagando correctamente por el trabajo, ni más ni menos. Pero el sindicalista ya con otro semblante, le dijo que esto lo iba a lamentar y sin dar más explicaciones, se fue. La obra quedó culminada, no hubo un día de asado durante la construcción. Y si bien había quedado perfectamente terminada, las operaciones de preventa comenzaron a cancelarse sin razón alguna. No recibía visitas ni interés alguno. El dueño no comprendía el por qué, se lo atribuyó a una maniobra mafiosa de los obreros o el sindicato mismo, pero nunca pudo probar nada. La construcción completa continúa sin habitarse y el deterioro cada vez más presente. Se dice que algunos vecinos escuchan voces y ven algunas sombras por las noches, como una construcción fantasmagórica y abandonada.",
                tags: ["Relato", "Urbano"]
            }
        ];

        // ----------------------------------------------------------------------
        // CÓDIGO DE LA APLICACIÓN
        // ----------------------------------------------------------------------

        const LienzoLiterario = () => {
            const [view, setView] = useState('library'); 
            const [activeText, setActiveText] = useState(null);
            const [darkMode, setDarkMode] = useState(false);
            const [localDrafts, setLocalDrafts] = useState([]);
            const [allTexts, setAllTexts] = useState([...BIBLIOTECA_OFICIAL]);

            useEffect(() => {
                const saved = localStorage.getItem('lienzoDrafts');
                if (saved) { setLocalDrafts(JSON.parse(saved)); }
            }, []);

            useEffect(() => {
                setAllTexts([...localDrafts, ...BIBLIOTECA_OFICIAL]);
            }, [localDrafts]);

            const saveDraft = (newText) => {
                const draftWithMeta = {
                    ...newText,
                    id: `draft-${Date.now()}`,
                    isDraft: true,
                    date: new Date().toLocaleDateString('es-ES', { day: 'numeric', month: 'short', year: 'numeric' }),
                };
                const updatedDrafts = [draftWithMeta, ...localDrafts];
                setLocalDrafts(updatedDrafts);
                localStorage.setItem('lienzoDrafts', JSON.stringify(updatedDrafts));
                setView('library');
            };

            const deleteDraft = (id) => {
                if(window.confirm("¿Eliminar este borrador?")) {
                    const updatedDrafts = localDrafts.filter(t => t.id !== id);
                    setLocalDrafts(updatedDrafts);
                    localStorage.setItem('lienzoDrafts', JSON.stringify(updatedDrafts));
                    if (activeText?.id === id) setView('library');
                }
            };

            const estimatedReadingTime = (text) => {
                const words = text.split(/\s+/).length;
                const minutes = Math.ceil(words / 200);
                return `${minutes} min`;
            };

            const Navigation = () => (
                <nav className={`fixed top-0 left-0 w-full z-50 flex justify-between items-center px-6 py-4 border-b transition-colors duration-500 ${darkMode ? 'bg-zinc-900 border-zinc-800 text-zinc-100' : 'bg-[#f4f1ea] border-stone-300 text-stone-800'}`}>
                    <div onClick={() => setView('library')} className="cursor-pointer flex items-center gap-2 group">
                        <Feather className={`w-5 h-5 transition-transform group-hover:rotate-[-15deg]`} />
                        <h1 className="text-xl font-bold tracking-tighter font-display uppercase">Mundo Dantastico</h1>
                    </div>
                    <div className="flex gap-4 items-center">
                        <button onClick={() => setDarkMode(!darkMode)} className="p-2 rounded-full hover:bg-black/5 dark:hover:bg-white/10 transition-colors">
                            {darkMode ? <Sun className="w-5 h-5" /> : <Moon className="w-5 h-5" />}
                        </button>
                        <button onClick={() => setView('composer')} className={`flex items-center gap-2 px-4 py-2 text-sm font-medium border transition-all duration-300 hover:shadow-[3px_3px_0px_0px_currentColor] ${darkMode ? 'border-zinc-700 hover:bg-zinc-800' : 'border-stone-800 hover:bg-white'}`}>
                            <PenTool className="w-4 h-4" />
                            <span className="hidden sm:inline">Nuevo Borrador</span>
                        </button>
                    </div>
                </nav>
            );

            const Library = () => (
                <div className="pt-24 pb-12 px-6 max-w-7xl mx-auto min-h-screen animate-fade-in">
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mt-12">
                        {allTexts.map((text) => (
                            <div key={text.id} onClick={() => { setActiveText(text); setView('reader'); }} className={`group relative cursor-pointer border p-6 ${text.image ? 'h-[26rem]' : 'h-80'} flex flex-col justify-between transition-all duration-500 hover:-translate-y-2 ${darkMode ? 'border-zinc-800 bg-zinc-900 hover:border-zinc-500' : 'border-stone-300 bg-[#f9f7f1] hover:border-stone-800 hover:shadow-xl'}`}>
                                {text.isDraft && <div className="absolute top-2 right-2 bg-yellow-200 text-yellow-900 text-[10px] font-mono px-2 py-1 uppercase tracking-wider font-bold z-10">Borrador Privado</div>}
                                
                                <div className="flex-1 flex flex-col">
                                    {/* PORTADA EN BIBLIOTECA */}
                                    {text.image && (
                                        <div className="w-[calc(100%+3rem)] -mx-6 -mt-6 mb-4 h-48 overflow-hidden border-b border-current opacity-90 group-hover:opacity-100 transition-opacity">
                                            <img src={text.image} alt={text.title} className="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105" />
                                        </div>
                                    )}

                                    <div className="flex justify-between items-start mb-4 mt-2">
                                        <span className="font-mono text-xs opacity-60">{text.date}</span>
                                        <span className="font-mono text-xs border rounded px-1 opacity-60 border-current">{text.tags[0]}</span>
                                    </div>
                                    <h3 className="text-2xl font-serif font-bold leading-tight mb-3 line-clamp-2 group-hover:underline decoration-1 underline-offset-4">{text.title}</h3>
                                    <p className={`font-serif text-lg leading-relaxed line-clamp-3 ${darkMode ? 'text-zinc-400' : 'text-stone-600'}`}>{text.content}</p>
                                </div>
                                <div className="flex justify-between items-end border-t border-dashed pt-4 border-current opacity-40 group-hover:opacity-100 transition-opacity mt-4">
                                    <span className="font-mono text-xs">{estimatedReadingTime(text.content)} lectura</span>
                                    <BookOpen className="w-4 h-4" />
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );

            const Reader = () => {
                if (!activeText) return null;
                return (
                    <div className="min-h-screen pt-24 pb-20 animate-slide-up">
                        <div className={`fixed top-[73px] left-0 h-1 bg-current opacity-20 w-full origin-left animate-grow`} />
                        <div className="max-w-3xl mx-auto px-6 md:px-12 relative">
                            <div className="mb-12 flex justify-between items-start">
                                <button onClick={() => setView('library')} className="flex items-center gap-2 font-mono text-xs hover:underline opacity-60 hover:opacity-100">
                                    <ChevronLeft className="w-4 h-4" /> VOLVER AL MUNDO
                                </button>
                                {activeText.isDraft && (
                                    <button onClick={() => deleteDraft(activeText.id)} className="text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 px-3 py-1 rounded flex items-center gap-2 transition-colors">
                                        <Trash2 className="w-4 h-4" /> <span className="text-xs font-mono">ELIMINAR BORRADOR</span>
                                    </button>
                                )}
                            </div>

                            {/* PORTADA EN MODO LECTURA */}
                            {activeText.image && (
                                <div className="mb-12 w-full h-64 md:h-96 overflow-hidden border border-current">
                                    <img src={activeText.image} className="w-full h-full object-cover grayscale hover:grayscale-0 transition-all duration-1000" alt="Portada" />
                                </div>
                            )}

                            <header className="mb-16 text-center">
                                <span className="font-mono text-xs tracking-widest uppercase mb-4 block opacity-60">{activeText.tags.join(' / ')} — {activeText.date}</span>
                                <h1 className="text-4xl md:text-6xl font-serif font-bold mb-6 leading-tight">{activeText.title}</h1>
                                <div className="w-12 h-1 bg-current mx-auto opacity-20"></div>
                            </header>
                            <article className={`prose prose-lg md:prose-xl mx-auto font-serif leading-loose ${darkMode ? 'prose-invert text-zinc-300' : 'text-stone-800'}`}>
                                {activeText.content.split('\n').map((paragraph, idx) => (
                                    paragraph.trim() === '' ? <br key={idx} /> : 
                                    <p key={idx} className="mb-6 first-letter:text-5xl first-letter:font-bold first-letter:float-left first-letter:mr-3 first-letter:mt-[-6px] first-letter:font-display">{paragraph}</p>
                                ))}
                            </article>
                            <div className="mt-24 pt-12 border-t border-dashed border-current opacity-30 text-center font-mono text-xs">*** FIN DE LA TRANSMISIÓN ***</div>
                        </div>
                    </div>
                );
            };

            const Composer = () => {
                const [title, setTitle] = useState('');
                const [content, setContent] = useState('');
                const [tag, setTag] = useState('');
                const handleSubmit = (e) => {
                    e.preventDefault();
                    if (!title || !content) return;
                    saveDraft({ title, content, tags: [tag || 'Sin categoría'] });
                };
                return (
                    <div className="min-h-screen pt-24 px-6 flex justify-center animate-fade-in">
                        <form onSubmit={handleSubmit} className="w-full max-w-2xl">
                            <button type="button" onClick={() => setView('library')} className="mb-8 flex items-center gap-2 font-mono text-xs hover:underline opacity-60 hover:opacity-100">
                                <ChevronLeft className="w-4 h-4" /> CANCELAR
                            </button>
                            <div className="p-6 border border-dashed border-current mb-8 bg-yellow-50 dark:bg-yellow-900/10">
                                <p className="font-mono text-xs opacity-70">
                                    <strong>MODO BORRADOR:</strong> Esto es para escribir ideas rápidas. 
                                    Para publicar oficialmente, recuerda copiar tu texto al código fuente.
                                </p>
                            </div>
                            <div className="space-y-8">
                                <div>
                                    <label className="block font-mono text-xs uppercase tracking-widest opacity-50 mb-2">Título</label>
                                    <input type="text" value={title} onChange={e => setTitle(e.target.value)} placeholder="Título..." className={`w-full text-3xl md:text-5xl font-serif font-bold bg-transparent border-b-2 border-transparent focus:border-current focus:outline-none placeholder-opacity-30 ${darkMode ? 'placeholder-zinc-600' : 'placeholder-stone-400'}`} autoFocus />
                                </div>
                                <div>
                                    <label className="block font-mono text-xs uppercase tracking-widest opacity-50 mb-2">Categoría</label>
                                    <input type="text" value={tag} onChange={e => setTag(e.target.value)} placeholder="Ej. Reflexión" className="w-full font-mono bg-transparent border-b border-dashed border-current focus:outline-none py-2 opacity-80" />
                                </div>
                                <div>
                                    <label className="block font-mono text-xs uppercase tracking-widest opacity-50 mb-4">Contenido</label>
                                    <textarea value={content} onChange={e => setContent(e.target.value)} placeholder="Escribe aquí..." className={`w-full h-96 bg-transparent resize-none font-serif text-lg leading-relaxed focus:outline-none placeholder-opacity-30 ${darkMode ? 'placeholder-zinc-600' : 'placeholder-stone-400'}`} />
                                </div>
                                <div className="flex justify-end pt-6 border-t border-current">
                                    <button type="submit" disabled={!title || !content} className={`flex items-center gap-2 font-mono text-sm uppercase tracking-widest px-8 py-3 border transition-all hover:translate-x-1 disabled:opacity-30 disabled:hover:translate-x-0 ${darkMode ? 'border-zinc-600 hover:bg-zinc-800' : 'border-stone-800 hover:bg-stone-200'}`}>
                                        <Save className="w-4 h-4" /> Guardar Borrador
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                );
            };

            // ESTA ES LA PARTE QUE FALTABA Y QUE CAUSABA EL ERROR:
            // Cierre del componente LienzoLiterario y renderizado principal
            
            return (
                <div className={`min-h-screen transition-colors duration-700 ease-in-out font-sans selection:bg-yellow-200 selection:text-black ${darkMode ? 'bg-zinc-950 text-zinc-200 selection:bg-fuchsia-900 selection:text-white' : 'bg-[#f4f1ea] text-[#2c2926]'}`}>
                    <Navigation />
                    <main>
                        {view === 'library' && <Library />}
                        {view === 'reader' && <Reader />}
                        {view === 'composer' && <Composer />}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(
            <div className="font-sans selection:bg-yellow-200 selection:text-black">
                <LienzoLiterario />
            </div>
        );
    </script>
</body>
</html>
